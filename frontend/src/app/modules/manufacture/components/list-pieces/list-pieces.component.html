
<div class="row">
  <div class="col-lg-3">
  <app-filter-list-pieces></app-filter-list-pieces>
  <br>
</div>
</div>

<!-- Content Row -->
<div class="row">
    <div class="col-lg-12">

        <!-- Dropdown Card Example -->
        <div class="card shadow mb-auto">
            <!-- Card Header - Dropdown -->
            <div
                class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                <h6 class="m-0 font-weight-bold text-primary">Pieces</h6>
                <div class="dropdown no-arrow">
                    <a class="dropdown-toggle" href="#" role="button" id="dropdownMenuLink"
                        data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        <i class="fas fa-ellipsis-v fa-sm fa-fw text-gray-400"></i>
                    </a>
                    <div class="dropdown-menu dropdown-menu-right shadow animated--fade-in"
                        aria-labelledby="dropdownMenuLink">
                        <div class="dropdown-header">Dropdown Header:</div>
                        <a class="dropdown-item" href="#">Action</a>
                        <a class="dropdown-item" href="#">Another action</a>
                        <div class="dropdown-divider"></div>
                        <a class="dropdown-item" href="#">Something else here</a>
                    </div>
                </div>
            </div>
            <!-- Card Body -->
            <div class="card-body">
                <div class="row">
                    <div class="col-sm-12 col-md-0">
                        <div class="dataTables_length" id="dataTable_length">
                            <!-- <label>Show
                                <select [formControl]="rowsNumForm" (click)="setNumRows()" name="dataTable_length" aria-controls="dataTable" class="custom-select custom-select-sm form-control form-control-sm">
                                    <option value="10">10</option>
                                    <option value="25">25</option>
                                    <option value="50">50</option>
                                    <option value="100">100</option>
                                    <option value="all">All</option>
                                </select> entries
                            </label> -->
                        </div>
                    </div>
                    <div class="col-sm-6 col-md-3">
                        <div id="dataTable_filter" class="dataTables_filter">
                            <label>Search:
                                <input type="search" (change)="setNameToSearch($event)" class="form-control form-control-sm" placeholder="" aria-controls="dataTable">
                            </label>
                        </div>
                    </div>
                    <div class="col-sm-6 col-md-0" style="text-align: right;">
                      <br>
                      <button class="btn btn-success" (click)="updateIsEdit(false)" data-toggle="modal" data-target="#pieceFormModal">Crear pieza</button>
                    </div>
                </div>
                <br>
                <div class="table-responsive">

                    <table class="table table-bordered" width="100%" cellspacing="0">
                        <thead>
                            <tr>
                                <th>id</th>
                                <th>Name</th>
                                <th>Costo</th>
                                <th>Tipo</th>
                                <th>Cantidad</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tfoot>
                            <tr>
                                <th>Id</th>
                                <th>Nombre</th>
                                <th>Costo</th>
                                <th>Categoria</th>
                                <th>Cantidad</th>
                                <th>Acciones</th>
                            </tr>
                        </tfoot>
                        <tbody>
                            <tr *ngFor="let item of list | paginate: { itemsPerPage: maxSizeRows, currentPage: pageNumber, totalItems: totalItems }">
                                <td>{{item.id}}</td>
                                <td>{{item.name}}</td>
                                <td>{{item.cost}}</td>
                                <td>{{item.category.name}}</td>
                                <td>{{item.stock}}</td>
                                <td>
                                  <app-actions
                                    (isEditEvent)="updateIsEdit($event)" (messageEvent)="changeSelectedId($event)"
                                    [model]="'piece'" [id]="item.id"
                                    [infModalId]="'pieceInfModal'"
                                    [formModalId]="'pieceFormModal'"
                                    [deleteModalId]="'undefined'"
                                    [addButton]="false">
                                    <button type="button" class="btn btn-outline-success" data-toggle="modal" (click)="setIdPiece(item.id)" data-target="#provideModal">Abastecer</button>
                                    <button type="button" class="btn btn-outline-primary" data-toggle="modal" (click)="setIdPieceAndCost(item.id,item.precio)" data-target="#exampleModal">Remover</button>
                                    <button type="button" class="btn btn-outline-danger" data-toggle="modal" (click)="setIdPiece(item.id)" data-target="#confirmModal">Eliminar</button>
                                  </app-actions>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                    <div class="row"><div class="col-sm-12 col-md-5">
                    </div>
                    <div class="col-sm-12 col-md-7">
                        <div class="dataTables_paginate paging_simple_numbers" id="dataTable_paginate">
                            <ul class="pagination">
                                <li class="paginate_button page-item active">
                                <pagination-controls
                                  (pageChange)="pageChanged($event)"
                                  [maxSize]= "5"
                                  [directionLinks]="true"
                                  [autoHide]="true"
                                  [responsive]="true"
                                  previousLabel="Previous"
                                  nextLabel="Next"
                                  screenReaderPaginationLabel="Pagination"
                                  screenReaderPageLabel="page"
                                  screenReaderCurrentLabel="You're on page">
                                </pagination-controls>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </div>
</div>

<!-- Modal para eliminar piezas del inventario (reducir cantidad) -->
<div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLabel">Remover piezas</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
            <form [formGroup]="formRemove" (ngSubmit)="removePieces()">
                <div class="form-group">
                  <label for="numpieces">Numero de piezas</label>
                  <input formControlName="totalRemove" type="number" class="form-control" id="numpieces" aria-describedby="emailHelp" >
                </div>
                <button type="submit" aria-hidden="true" [disabled]="formRemove.invalid" class="btn btn-danger">Eliminar</button>
              </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancelar</button>
        </div>
      </div>
    </div>
</div>

<!-- Modal para proveer piezas -->
<div class="modal fade" id="provideModal" tabindex="-1" role="dialog" aria-labelledby="provideModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="provideModalLabel">Agregar nueva pieza</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
            <form [formGroup]="formProvide" (ngSubmit)="providePieces()">
                <div class="form-group">
                  <label for="numpieces">Numero de piezas</label>
                  <input formControlName="totalProvide" type="number" autocomplete="off" class="form-control" id="numpieces" aria-describedby="emailHelp" >
                </div>
                <div class="form-group">
                    <label for="costpieces">Costo de compra</label>
                    <input formControlName="cost" type="text" autocomplete="off" class="form-control" id="costpieces" aria-describedby="emailHelp" >
                  </div>

                <button type="submit" [disabled]="formProvide.invalid" class="btn btn-success">Agregar</button>
              </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancelar</button>
        </div>
      </div>
    </div>
</div>

<!-- Modal para eliminar la pieza -->
<div class="modal fade" id="confirmModal" tabindex="-1" role="dialog" aria-labelledby="confirmModal" aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="confirmModal">Remover piezas</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
            <h4>¿Desea eliminar las piezas?</h4>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" (click)="deletePiece()" data-dismiss="modal">Si</button>
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancelar</button>
        </div>
      </div>
    </div>
</div>
<div (feedbackEvent)="sendFeedback($event)"></div>
